# Guia de Uso do UFW (Uncomplicated Firewall)

## üìÑ Resumo

O **UFW** √© uma ferramenta simplificada para gerenciar o firewall no servidor.  
Ele serve como uma interface amig√°vel para o **iptables** ou **nftables**, permitindo configurar regras de forma simples sem precisar lidar com comandos complexos de firewall do kernel.  

Com o UFW, √© poss√≠vel:

- Permitir ou negar acesso a portas e servi√ßos.
- Criar regras por IP ou rede.
- Ativar logs de conex√£o.
- Garantir a seguran√ßa b√°sica do servidor de forma r√°pida.

---

## üíª Instala√ß√£o

No Ubuntu, o UFW geralmente j√° vem instalado. Para garantir ou instalar manualmente:

```bash
sudo apt update
sudo apt install ufw -y
```
# **‚ö†Ô∏è Aten√ß√£o, antes de habilitar o UFW se estiver remoto via SSSH‚ö†Ô∏è**
> ‚ö†Ô∏èOBSERVA√á√ÉO IMPORTANTE: CUIDADO QUANDO VOC√ä HABILITAR O UFW UTILIZANDO UMA CONEX√ÉO REMOTA, AP√ìS DIGITAR O COMANDO: sudo ufw enable A SEGUINTE MENSAGEM √â MOSTRADA: Command may disrupt existing ssh connections (O comando pode interromper as conex√µes ssh existentes), EM ALGUNS CEN√ÅRIOS PODE ACONTECER A QUEDA (DESCONECTAR) DA CONEX√ÉO E VOC√ä N√ÉO CONSEGUIR MAIS ACESSAR O SERVIDOR REMOTAMENTE.

Habilitando e iniciando o Firewall UFW
```bash
sudo ufw enable
```
Verifique o status do UFW:
```bash
sudo ufw status verbose
```

Verificando o servi√ßo do UFW
```bash
sudo systemctl status ufw
sudo systemctl restart ufw
sudo systemctl stop ufw
sudo systemctl start ufw
```
Analisando os Log's e mensagens de erro do UFW
```bash
# op√ß√£o do comando journalctl: x (catalog), e (pager-end), u (unit)
sudo journalctl -xeu ufw
```
---

## üîπ Entendendo as Regras

O UFW funciona com **regras de permiss√£o ou nega√ß√£o** para servi√ßos, portas ou IPs:

* `allow` ‚Üí Permite acesso.
* `deny` ‚Üí Bloqueia acesso. (n√£o informa nada ao host apenas bloqueia)
* `reject` ‚Üí Rejeita acesso (mas informa o host que foi rejeitado).
* `limit` ‚Üí Permite acesso com prote√ß√£o contra ataques de for√ßa bruta.
* `disable` ‚Üí Desabilita

Exemplos:

```bash
sudo ufw allow 22          # Permite SSH
sudo ufw deny 21           # Bloqueia FTP
sudo ufw allow 80/tcp      # Permite HTTP
sudo ufw limit 22/tcp      # Limita tentativas SSH
sudo ufw allow from 192.168.1.100   # Permite acesso de um IP espec√≠fico
```


## üõ°Ô∏è Melhores Pr√°ticas

1. **Permitir somente servi√ßos essenciais**:

* SSH (`22`) para acesso remoto
* HTTP (`80`) e HTTPS (`443`) se houver web server

2. **Bloquear tudo por padr√£o**:

```bash
sudo ufw default deny incoming
sudo ufw default allow outgoing
```

3. **Usar `limit` para servi√ßos sens√≠veis** (como SSH):

```bash
sudo ufw limit 22/tcp
```

Compara√ß√£o de Regras no UFW

| Comando                          | O que faz                                                                 | Quando usar                                                                 |
|----------------------------------|---------------------------------------------------------------------------|------------------------------------------------------------------------------|
| `sudo ufw allow 22/tcp`          | Permite livre acesso √† porta (no caso, SSH).                              | Quando precisa liberar um servi√ßo para todos os clientes.                    |
| `sudo ufw deny 21/tcp`           | Bloqueia o acesso √† porta (no caso, FTP).                                 | Quando quer garantir que um servi√ßo/porta n√£o seja acess√≠vel externamente.   |
| `sudo ufw limit 22/tcp`          | Permite conex√µes, mas limita tentativas excessivas (6 em 30s por IP).     | Ideal para portas cr√≠ticas (SSH, SMTP), como prote√ß√£o contra for√ßa bruta.    |



---

## Para listar regras atuais:

```bash
sudo ufw status numbered
```

Para remover uma regra espec√≠fica:

```bash
sudo ufw delete [N√öMERO_DA_REGRA]
```


# 05_ Localiza√ß√£o dos Arquivos e Diret√≥rio de Configura√ß√£o do UFW no Ubuntu Server
```bash
/etc/default/ufw   <-- Arquivo de inicializa√ß√£o padr√£o do UFW
/etc/ufw/*         <-- Diret√≥rio padr√£o das configura√ß√µes das regras do UFW
/var/log/ufw.log   <-- Arquivo de Log padr√£o do UFW
/var/log/syslog    <-- Logs do UFW no sistema (usar o filtro: cat /var/log/syslog | grep -i ufw)
/var/log/kern.log  <-- Logs do UFW no Kernel (usar o filtro: cat /var/log/syslog | grep -i ufw)
```
---

## ‚öôÔ∏è Como Aplicar Regras

1. **Ativar o UFW**:

```bash
sudo ufw enable
```

2. **Desativar o UFW (se necess√°rio)**:

```bash
sudo ufw disable
```

3. **Resetar para o estado padr√£o**:

```bash
sudo ufw reset
```

4. **Habilitar logs** (√∫til para monitorar acessos):

```bash
sudo ufw logging on
```

---

## üõ°Ô∏è Melhores Pr√°ticas

1. **Permitir somente servi√ßos essenciais**:

* SSH (`22`) para acesso remoto
* HTTP (`80`) e HTTPS (`443`) se houver web server

2. **Bloquear tudo por padr√£o**:

```bash
sudo ufw default deny incoming
sudo ufw default allow outgoing
```

3. **Usar `limit` para servi√ßos sens√≠veis** (como SSH):

```bash
sudo ufw limit 22/tcp
```

4. **Restringir acesso por IP quando poss√≠vel**:

```bash
sudo ufw allow from 192.168.1.100 to any port 22
```

5. **Verificar regras e logs periodicamente**:

```bash
sudo ufw status verbose
sudo ufw show added
sudo tail -f /var/log/ufw.log
```

6. **Integrar com Docker ou outros servi√ßos com aten√ß√£o**:

* O Docker pode adicionar regras diretamente ao iptables.
* Para servidores com containers, verifique se as portas expostas est√£o corretamente liberadas no UFW.

---

> ‚ö†Ô∏è Lembre-se: Sempre teste as regras antes de aplicar em produ√ß√£o, para evitar perder acesso SSH ao servidor.

# Configurando o N√≠vel de Log (LOGGING) do UFW no Ubuntu Server

> OBSERVA√á√ÉO IMPORTANTE: no UFW temos basicamente 05 (cinco) n√≠veis de Log: off (desligado), low (baixo), medium (m√©dio), high (alto) e full (completo/debug).

o que muda √© as informa√ß√µes que ser√£o registradas, ent√£o temos que pensar a nivel de armazenamento o tanto de logs que queremos registrar 

Recomendado √© `MEDUM`

```bash
#Habilitando os Logs das Regras do UFW
sudo ufw logging on
  Logging enabled

#Configurando o N√≠vel de Log de Baixo (LOW) para M√©dio (MEDIUM)
sudo ufw logging medium
  Logging enabled

#Verificando as Regras Detalhadas padr√£o do UFW
sudo ufw status verbose
```
# Liberando (ALLOW) a Entrada (INCOMING) e Sa√≠da (OUTGOING) da Interface de Loopback do UFW no Ubuntu Server

> OBSERVA√á√ÉO IMPORTANTE: por padr√£o, o UFW no Ubuntu Server adiciona automaticamente regras de IPv6 para regras da Interface de Loopback.

```bash
#Liberando (ALLOW) a Entrada (IN) da Interface (ON) Loopback (LO)
sudo ufw allow in on lo

#Liberando (ALLOW) a Sa√≠da (OUT) da Interface (ON) Loopback (LO)
sudo ufw allow out on lo

#Verificando as Regras Detalhadas padr√£o do UFW
sudo ufw status verbose

#Verificando o Status das Regras (RULES) Numeradas (NUMBERED) do UFW
sudo ufw status numbered
```
# Liberando (ALLOW) as Sa√≠das (OUTGOING) B√°sicas do UFW no Ubuntu Server
>‚ö†Ô∏è OBSERVA√á√ÉO IMPORTANTE: por padr√£o, o UFW no Ubuntu Server adiciona automaticamente regras de IPv6 para regras criadas de forma simples ou b√°sica.

>‚ö†Ô∏è OBSERVA√á√ÉO IMPORTANTE: quando voc√™ utilizar a op√ß√£o: comment (coment√°rio) do UFW √© recomendo n√£o utilizar acentua√ß√£o e sempre dentro de Aspas Simples (n√£o crase).

>‚ö†Ô∏è OBSERVA√á√ÉO IMPORTANTE: muito cuidado na hora de configurar a Sequ√™ncia de Regras do UFW, ele segue o padr√£o de: Primeira Regra Correspondente (de cima para baixo), A√ß√£o da Regra (allow, deny, reject), Regras Subsequentes (continua se n√£o encontrar uma regra) e Regra Padr√£o (default).

>‚ö†Ô∏è OBSERVA√á√ÉO IMPORTANTE: o UFW tamb√©m processa as regas da seguinte forma: Regras de Porta Espec√≠fica (maior prioridade), Regras de Protocolo e Porta (alta prioridade), Regras de Aplica√ß√£o de Servi√ßo (prioridade intermediaria), Regras de Subnet (menor prioridade), Regras de Interface (menor prioridade) e Regras de App Profile (essa regra tem menor prioridade e sempre fica por √∫ltimo).

```bash

#Regra de libera√ß√£o (ALLOW) de Sa√≠da (OUT) da Consulta do Protocolo DNS (53/udp)
sudo ufw allow out 53/udp comment 'Liberando a saida para consulta do DNS'

#Regra de libera√ß√£o (ALLOW) de Sa√≠da (OUT) da Navega√ß√£o do Protocolo HTTP (80/tcp)
sudo ufw allow out 80/tcp comment 'Liberando a saida para navega√ß√£o do HTTP'

#Regra de libera√ß√£o (ALLOW) de Sa√≠da (OUT) da Navega√ß√£o do Protocolo HTTPS (443/tcp)
sudo ufw allow out 443/tcp comment 'Liberando a saida para navega√ß√£o do HTTPS'

#Regra de libera√ß√£o (ALLOW) de Sa√≠da (OUT) do Protocolo NTP (123/udp)
sudo ufw allow out 123/udp comment 'Liberando a saida para sincronismo do NTP'

#Verificando as Regras Detalhadas padr√£o do UFW
sudo ufw status verbose

#Verificando as Regras Detalhadas padr√£o do UFW em modo Numerado
sudo ufw status numbered

#Resolvendo o nome DNS do Google
nslookup google.com

#Pingando o nome DNS do Google
ping google.com

#Atualizando as Listas do Sources.List do Apt
sudo apt update